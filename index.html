<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>PINE Tycoon ‚Äì –ì–æ–ª–æ–≤–Ω–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #f4f4f4;
      --text: #222;
      --card-bg: #ffffff;
      --accent: #383837;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      position: relative;
      overflow-x: hidden;
    }

    /* –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏ */
    header,
    .card {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }

    body.loaded header,
    body.loaded .card {
      opacity: 1;
      transform: translateY(0);
    }

    /* –°–Ω—ñ–≥ */
    #snowCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    header,
    main,
    footer {
      position: relative;
      z-index: 1;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: #383837;
      color: #fff;
    }

    .logo {
      font-weight: 700;
      letter-spacing: 1px;
    }

    nav {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    nav a {
      text-decoration: none;
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
      background: rgba(255,255,255,0.08);
      font-size: 14px;
      transition:
        transform 0.2s ease,
        background 0.2s ease,
        box-shadow 0.2s ease;
    }

    nav a:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-1px) scale(1.03);
      box-shadow: 0 4px 10px rgba(0,0,0,0.18);
    }

    .auth-buttons button {
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      margin-left: 6px;
      cursor: pointer;
      font-size: 14px;
      background: #ffffff;
      color: #383837;
      transition:
        transform 0.2s ease,
        background 0.2s ease,
        box-shadow 0.2s ease;
    }

    .auth-buttons button:hover {
      background: #f1f1f1;
      transform: translateY(-1px) scale(1.03);
      box-shadow: 0 4px 10px rgba(0,0,0,0.18);
    }

    main {
      max-width: 1000px;
      margin: 30px auto;
      padding: 0 15px 30px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }

    .hero {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .hero img {
      max-width: 260px;
      border-radius: 12px;
      border: 3px solid #383837;
    }

    .hero-top {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
    }

    .hero-text h1 {
      margin: 0 0 8px;
      font-size: 26px;
      color: #383837;
    }

    .hero-text p {
      margin: 4px 0;
    }

    .status-box {
      font-size: 14px;
      color: #555;
    }

    .blog-section h2 {
      margin-top: 0;
      margin-bottom: 8px;
    }

    .blog-section p {
      margin-top: 4px;
    }

    .auth-forms {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    form {
      flex: 1;
      min-width: 250px;
    }

    form h3 {
      margin-top: 0;
      margin-bottom: 8px;
    }

    label {
      display: block;
      font-size: 13px;
      margin-top: 6px;
    }

    input[type="text"],
    input[type="email"],
    input[type="password"] {
      width: 100%;
      box-sizing: border-box;
      margin-top: 2px;
      padding: 6px 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }

    form button[type="submit"],
    #deleteUserBtn,
    #logoutBtn {
      margin-top: 10px;
      padding: 7px 12px;
      border-radius: 6px;
      border: none;
      background: #383837;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
      transition:
        background 0.2s ease,
        transform 0.2s ease,
        box-shadow 0.2s ease;
    }

    form button[type="submit"]:hover,
    #deleteUserBtn:hover,
    #logoutBtn:hover {
      background: #222;
      transform: translateY(-1px) scale(1.03);
      box-shadow: 0 4px 10px rgba(0,0,0,0.18);
    }

    #deleteUserBtn {
      background: #e53935;
    }
    #deleteUserBtn:hover {
      background: #c62828;
    }

    #logoutBtn {
      background: #e74c3c;
    }
    #logoutBtn:hover {
      background: #c0392b;
    }

    .small-text {
      font-size: 12px;
      color: #777;
      margin-top: 4px;
    }

    .hidden {
      display: none !important;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .avatar {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid #383837;
    }

    .user-name {
      font-weight: 600;
    }

    /* Admin panel */
    #adminPanel {
      margin-top: 16px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #e57373;
      background: #ffebee;
      font-size: 14px;
    }

    #adminPanel h3 {
      margin-top: 0;
      margin-bottom: 6px;
      color: #c62828;
    }

    #deleteUserInput {
      width: 100%;
      box-sizing: border-box;
      margin-top: 4px;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    #deleteUserStatus {
      margin-top: 6px;
      font-size: 13px;
    }

    /* –î—Ä—É–∑—ñ + –ø–æ—à—É–∫ */
    .social-layout {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .search-block,
    .friends-block {
      flex: 1;
      min-width: 260px;
    }

    #searchResults,
    #friendsList,
    #friendRequestsList {
      list-style: none;
      padding-left: 0;
      margin: 6px 0 0;
    }

    #searchResults li,
    #friendsList li,
    #friendRequestsList li {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
      font-size: 14px;
      flex-wrap: wrap;
    }

    .online-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #95a5a6;
      flex-shrink: 0;
    }

    .small-btn {
      padding: 3px 8px;
      border-radius: 6px;
      border: none;
      font-size: 12px;
      cursor: pointer;
      background: #383837;
      color: #fff;
      transition:
        background 0.2s ease,
        transform 0.2s ease,
        box-shadow 0.2s ease;
    }

    .small-btn:hover {
      background: #222;
      transform: translateY(-1px) scale(1.03);
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .small-btn.danger {
      background: #e74c3c;
    }
    .small-btn.danger:hover {
      background: #c0392b;
    }

    footer {
      text-align: center;
      padding: 12px 10px;
      background: #383837;
      color: #fff;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">PINE Tycoon</div>
    <nav>
      <a href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a>
      <a href="game.html">–ì—Ä–∞—Ç–∏!</a>
      <a href="#blog">–ë–ª–æ–≥</a>

      <div class="auth-buttons" id="authButtons">
        <button id="showAuthBtn">Sign in / Sign up</button>
      </div>

      <div class="user-info hidden" id="userInfo">
        <div class="avatar" id="userAvatar"></div>
        <span class="user-name" id="userName"></span>
        <button id="logoutBtn">–í–∏–π—Ç–∏</button>
      </div>
    </nav>
  </header>

  <!-- –°–Ω—ñ–≥ -->
  <canvas id="snowCanvas"></canvas>

  <main>
    <!-- –ì–æ–ª–æ–≤–Ω–∏–π –±–ª–æ–∫ –ø—Ä–æ –≥—Ä—É -->
    <section class="card hero">
      <div class="hero-top">
        <img
          src="https://learn.logikaschool.com/uploads/student/4796102/6929d42d4c366.png"
          alt="PINE Tycoon –ª–æ–≥–æ"
        />
        <div class="hero-text">
          <h1>PINE Tycoon</h1>
          <p>
            –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –∑–∏–º–æ–≤–æ–≥–æ —Ç–∞–π–∫—É–Ω–∞, –¥–µ –≤–∏ —Ä—É–±–∞—î—Ç–µ –¥–µ—Ä–µ–≤–∞, –±—É–¥—É—î—Ç–µ
            –¥–µ—Ä–µ–≤‚Äô—è–Ω–µ —Å–µ–ª–æ —Ç–∞ –Ω–∞–º–∞–≥–∞—î—Ç–µ—Å—å –Ω–µ –∑–∞–º–µ—Ä–∑–Ω—É—Ç–∏ –≤ –∑–∞–º–µ—Ç—ñ–ª—ñ üå®Ô∏è
          </p>
          <p class="status-box">
            –ü–æ—Ç–æ—á–Ω–∞ –≤–µ—Ä—Å—ñ—è: <b>1.0 ‚Äì –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä–Ω–∞ –∞–ª—å—Ñ–∞</b><br />
            –î–æ–¥–∞–Ω–æ: —Å–∏—Å—Ç–µ–º—É –∞–∫–∞—É–Ω—Ç—ñ–≤, –¥—Ä—É–∑—ñ–≤, –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä —Ç–∞ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω.
          </p>
        </div>
      </div>
    </section>

    <!-- –ê–∫–∞—É–Ω—Ç–∏ -->
    <section class="card" id="authCard">
      <h2>–ê–∫–∞—É–Ω—Ç</h2>
      <p class="small-text">
        –°—Ç–≤–æ—Ä–∏ –∞–∫–∞—É–Ω—Ç, —â–æ–± –≥—Ä–∞—Ç–∏ –ø—ñ–¥ —Å–≤–æ—ó–º —ñ–º‚Äô—è–º —É –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä—ñ, –¥–æ–¥–∞–≤–∞—Ç–∏ –¥—Ä—É–∑—ñ–≤ —Ç–∞ –±–∞—á–∏—Ç–∏, —Ö—Ç–æ –æ–Ω–ª–∞–π–Ω.
      </p>

      <div class="auth-forms">
        <!-- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è -->
        <form id="signupForm">
          <h3>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h3>
          <label>
            –ù—ñ–∫–Ω–µ–π–º (–±—É–¥–µ –≤–∏–¥–Ω–æ —É –≥—Ä—ñ)
            <input type="text" id="signupName" required />
          </label>
          <label>
            Email
            <input type="email" id="signupEmail" required />
          </label>
          <label>
            –ü–∞—Ä–æ–ª—å
            <input type="password" id="signupPassword" required />
          </label>
          <button type="submit">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç</button>
          <div class="small-text">
            –ü–æ—Ä–∞–¥–∞: –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π —Å–≤—ñ–π —ñ—Å–Ω—É—é—á–∏–π –Ω—ñ–∫, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ <b>davyd3102</b>.
          </div>
          <div id="signupStatus" class="small-text"></div>
        </form>

        <!-- –í—Ö—ñ–¥ -->
        <form id="loginForm">
          <h3>–í—Ö—ñ–¥</h3>
          <label>
            Email
            <input type="email" id="loginEmail" required />
          </label>
          <label>
            –ü–∞—Ä–æ–ª—å
            <input type="password" id="loginPassword" required />
          </label>
          <button type="submit">–£–≤—ñ–π—Ç–∏</button>
          <div id="loginStatus" class="small-text"></div>
        </form>
      </div>
    </section>

    <!-- –ë–ª–æ–∫ –¥–ª—è –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ + –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å -->
    <section class="card hidden" id="loggedCard">
      <h2>–ü—Ä–∏–≤—ñ—Ç, <span id="welcomeName">–≥—Ä–∞–≤—Ü—é</span>!</h2>
      <p>
        –¢–∏ —É–≤—ñ–π—à–æ–≤ —É —Å–∏—Å—Ç–µ–º—É. –¢–µ–ø–µ—Ä, –∫–æ–ª–∏ —Ç–∏ –∑–∞–ø—É—Å–∫–∞—î—à –≥—Ä—É
        —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É <b>–ì—Ä–∞—Ç–∏!</b>, –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä —Ä–æ–∑–ø—ñ–∑–Ω–∞—î —Ç–≤–æ—î —ñ–º‚Äô—è.
      </p>

      <!-- –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å –ª–∏—à–µ –¥–ª—è davyd3102 -->
      <div id="adminPanel" class="hidden">
        <h3>Admin –ø–∞–Ω–µ–ª—å (—Ç—ñ–ª—å–∫–∏ –¥–ª—è davyd3102)</h3>
        <p class="small-text">
          –¢—É—Ç —Ç–∏ –º–æ–∂–µ—à –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó <b>users</b> —Ç–∞ <b>gamePlayers</b>.
          –¶–µ –Ω—ñ–±–∏ "–±–∞–Ω" ‚Äì –ø—Ä–æ—Ñ—ñ–ª—å –∑–Ω–∏–∫–Ω–µ –∑ —Å–∞–π—Ç—É —Ç–∞ –∑ –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä–∞.
        </p>

        <label>
          –Ü–º‚Äô—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è:
          <input id="deleteUserInput" type="text" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 3102" />
        </label>

        <button id="deleteUserBtn">–í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</button>
        <div id="deleteUserStatus"></div>
      </div>
    </section>

    <!-- –î—Ä—É–∑—ñ + –ø–æ—à—É–∫ -->
    <section class="card" id="socialCard">
      <h2>–ì—Ä–∞–≤—Ü—ñ —Ç–∞ –¥—Ä—É–∑—ñ</h2>
      <div class="social-layout">
        <div class="search-block">
          <h3>–ü–æ—à—É–∫ –≥—Ä–∞–≤—Ü—ñ–≤</h3>
          <p class="small-text">–í–≤–µ–¥–∏ –Ω—ñ–∫ —Ç–æ—á–Ω–æ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: <b>3102</b>).</p>
          <div style="display:flex; gap:6px; margin-bottom:4px;">
            <input type="text" id="searchNameInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º" style="flex:1;">
            <button id="searchBtn" class="small-btn">–ó–Ω–∞–π—Ç–∏</button>
          </div>
          <p id="searchSummary" class="small-text">–©–µ –Ω—ñ–∫–æ–≥–æ –Ω–µ —à—É–∫–∞–ª–∏.</p>
          <ul id="searchResults"></ul>
        </div>

        <div class="friends-block">
          <h3>–î—Ä—É–∑—ñ</h3>
          <p id="friendRequestsSummary" class="small-text">–ó–∞–ø–∏—Ç—ñ–≤ —É –¥—Ä—É–∑—ñ –Ω–µ–º–∞—î.</p>
          <ul id="friendRequestsList"></ul>
          <h4 style="margin-top:10px;">–°–ø–∏—Å–æ–∫ –¥—Ä—É–∑—ñ–≤</h4>
          <ul id="friendsList"></ul>
        </div>
      </div>
    </section>

    <!-- –ë–ª–æ–≥ -->
    <section class="card blog-section" id="blog">
      <h2>–ë–ª–æ–≥</h2>
      <p><i>–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:</i></p>
      <ul>
        <li>–î–æ–¥–∞–Ω–æ —Å–∏—Å—Ç–µ–º—É –∞–∫–∞—É–Ω—Ç—ñ–≤ –Ω–∞ Firebase.</li>
        <li>–î–æ–¥–∞–Ω–æ –¥—Ä—É–∑—ñ–≤, –ø–æ—à—É–∫ –≥—Ä–∞–≤—Ü—ñ–≤ —Ç–∞ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω —É —Å–ø–∏—Å–∫—É –¥—Ä—É–∑—ñ–≤ —ñ –ø–æ—à—É–∫—É.</li>
        <li>–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä –º—ñ–∂ –≥—Ä–∞–≤—Ü—è–º–∏ (–ø–µ—Ä—à–∞ –∞–ª—å—Ñ–∞).</li>
        <li>–î–æ–¥–∞–Ω–æ —Å–Ω—ñ–≥–æ–≤—É –∞–Ω—ñ–º–∞—Ü—ñ—é —Ç–∞ –ø–ª–∞–≤–Ω—ñ –ø–µ—Ä–µ—Ö–æ–¥–∏.</li>
      </ul>
      <p>–ù–µ–∑–∞–±–∞—Ä–æ–º —Ç—É—Ç –∑‚Äô—è–≤–ª—è—Ç—å—Å—è –Ω–æ—Ç–∞—Ç–∫–∏ –ø—Ä–æ —Ä–æ–∑—Ä–æ–±–∫—É, –∑–º—ñ–Ω–∏ –±–∞–ª–∞–Ω—Å—É —Ç–∞ –Ω–æ–≤—ñ –±—É–¥—ñ–≤–ª—ñ.</p>
    </section>
  </main>

  <footer>
    ¬© 2025 PINE Tycoon ‚Äî –±–µ—Ç–∞-–≤–µ—Ä—Å—ñ—è –≥—Ä–∏ –∑ –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä–æ–º
  </footer>

  <!-- Firebase + –ª–æ–≥—ñ–∫–∞ –∞–∫–∞—É–Ω—Ç—ñ–≤, –¥—Ä—É–∑—ñ–≤, –∞–¥–º—ñ–Ω–∫–∏, –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å—É —ñ —Å–Ω—ñ–≥—É -->
  <script type="module">
    /* –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏ */
    window.addEventListener("load", () => {
      document.body.classList.add("loaded");
    });

    /* –°–∏–Ω—ñ–π —Å–Ω—ñ–≥ */
    const snowCanvas = document.getElementById("snowCanvas");
    const snowCtx = snowCanvas.getContext("2d");
    let snowflakes = [];
    let lastSnowTime = 0;

    function resizeSnow() {
      snowCanvas.width = window.innerWidth;
      snowCanvas.height = window.innerHeight;
    }

    function initSnow(count = 150) {
      resizeSnow();
      snowflakes = [];
      for (let i = 0; i < count; i++) {
        snowflakes.push({
          x: Math.random() * snowCanvas.width,
          y: Math.random() * snowCanvas.height,
          r: 1 + Math.random() * 1.8,
          speed: 20 + Math.random() * 40,
          drift: -15 + Math.random() * 30
        });
      }
    }

    function snowLoop(timestamp) {
      const dt = (timestamp - lastSnowTime) / 1000 || 0;
      lastSnowTime = timestamp;

      snowCtx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);
      snowCtx.fillStyle = "rgba(80,160,255,0.9)";

      for (const f of snowflakes) {
        f.y += f.speed * dt;
        f.x += f.drift * dt;

        if (f.y > snowCanvas.height + f.r) {
          f.y = -f.r;
          f.x = Math.random() * snowCanvas.width;
        }
        if (f.x < -10) f.x = snowCanvas.width + 10;
        if (f.x > snowCanvas.width + 10) f.x = -10;

        snowCtx.beginPath();
        snowCtx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
        snowCtx.fill();
      }

      requestAnimationFrame(snowLoop);
    }

    initSnow(150);
    requestAnimationFrame(snowLoop);
    window.addEventListener("resize", () => {
      resizeSnow();
      initSnow(snowflakes.length || 150);
    });

    // -------- Firebase --------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
    import {
      getAuth,
      onAuthStateChanged,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
    import {
      getFirestore,
      collection,
      doc,
      setDoc,
      getDocs,
      query,
      where,
      deleteDoc,
      serverTimestamp,
      onSnapshot,
      addDoc
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDZEwAbFwLQXxlkkmuMKBFof2J3OE02Egs",
      authDomain: "pine-tycoon.firebaseapp.com",
      projectId: "pine-tycoon",
      storageBucket: "pine-tycoon.firebasestorage.app",
      messagingSenderId: "949986190236",
      appId: "1:949986190236:web:4f5d50078326f5c1981e59",
      measurementId: "G-2DY6KSY4G7"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM
    const authCard     = document.getElementById("authCard");
    const loggedCard   = document.getElementById("loggedCard");
    const welcomeName  = document.getElementById("welcomeName");

    const signupForm   = document.getElementById("signupForm");
    const signupName   = document.getElementById("signupName");
    const signupEmail  = document.getElementById("signupEmail");
    const signupPass   = document.getElementById("signupPassword");
    const signupStatus = document.getElementById("signupStatus");

    const loginForm    = document.getElementById("loginForm");
    const loginEmail   = document.getElementById("loginEmail");
    const loginPass    = document.getElementById("loginPassword");
    const loginStatus  = document.getElementById("loginStatus");

    const authButtons  = document.getElementById("authButtons");
    const showAuthBtn  = document.getElementById("showAuthBtn");
    const userInfo     = document.getElementById("userInfo");
    const userAvatar   = document.getElementById("userAvatar");
    const userNameEl   = document.getElementById("userName");
    const logoutBtn    = document.getElementById("logoutBtn");

    const adminPanel       = document.getElementById("adminPanel");
    const deleteUserInput  = document.getElementById("deleteUserInput");
    const deleteUserBtn    = document.getElementById("deleteUserBtn");
    const deleteUserStatus = document.getElementById("deleteUserStatus");

    const searchNameInput  = document.getElementById("searchNameInput");
    const searchBtn        = document.getElementById("searchBtn");
    const searchSummary    = document.getElementById("searchSummary");
    const searchResultsEl  = document.getElementById("searchResults");

    const friendRequestsSummary = document.getElementById("friendRequestsSummary");
    const friendRequestsList    = document.getElementById("friendRequestsList");
    const friendsListEl         = document.getElementById("friendsList");

    // –°—Ç–∞–Ω
    let currentUser = null;
    let friendsUnsub = null;
    let incomingReqUnsub = null;
    let outgoingReqUnsub = null;

    let onlineMap = new Map();           // uid -> { online: bool }
    let friendsData = [];                // { uid, name }
    let incomingRequestsData = [];       // { id, fromUid, fromName }
    let outgoingRequestsSet = new Set(); // toUid
    let lastSearchResults = [];          // { uid, name }
    const MAX_INACTIVE_MS = 30000;       // 30 —Å–µ–∫—É–Ω–¥

    // –ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –±–ª–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –ø–æ –∫–Ω–æ–ø—Ü—ñ –≤ —Ö–µ–¥–µ—Ä—ñ
    if (showAuthBtn) {
      showAuthBtn.addEventListener("click", () => {
        if (authCard.classList.contains("hidden")) {
          authCard.classList.remove("hidden");
        } else {
          authCard.classList.add("hidden");
        }
      });
    }

    // -------- –§—É–Ω–∫—Ü—ñ—ó —Ä–µ–Ω–¥–µ—Ä—É --------
    function renderFriends() {
      friendsListEl.innerHTML = "";
      friendRequestsList.innerHTML = "";

      if (!currentUser) {
        friendRequestsSummary.textContent = "–£–≤—ñ–π–¥–∏, —â–æ–± –±–∞—á–∏—Ç–∏ –∑–∞–ø–∏—Ç–∏ —Ç–∞ –¥—Ä—É–∑—ñ–≤.";
        const li = document.createElement("li");
        li.className = "small-text";
        li.textContent = "–£–≤—ñ–π–¥–∏, —â–æ–± –±–∞—á–∏—Ç–∏ –¥—Ä—É–∑—ñ–≤.";
        friendsListEl.appendChild(li);
        return;
      }

      // –ó–∞–ø–∏—Ç–∏
      if (incomingRequestsData.length === 0) {
        friendRequestsSummary.textContent = "–ó–∞–ø–∏—Ç—ñ–≤ —É –¥—Ä—É–∑—ñ –Ω–µ–º–∞—î.";
      } else {
        friendRequestsSummary.textContent = "–ó–∞–ø–∏—Ç–∏ —É –¥—Ä—É–∑—ñ:";
        incomingRequestsData.forEach(req => {
          const li = document.createElement("li");

          const nameSpan = document.createElement("span");
          nameSpan.textContent = req.fromName;
          li.appendChild(nameSpan);

          const acceptBtn = document.createElement("button");
          acceptBtn.className = "small-btn";
          acceptBtn.textContent = "–ü—Ä–∏–π–Ω—è—Ç–∏";
          acceptBtn.addEventListener("click", () => acceptFriendRequest(req));
          li.appendChild(acceptBtn);

          const rejectBtn = document.createElement("button");
          rejectBtn.className = "small-btn danger";
          rejectBtn.textContent = "–í—ñ–¥—Ö–∏–ª–∏—Ç–∏";
          rejectBtn.addEventListener("click", () => rejectFriendRequest(req));
          li.appendChild(rejectBtn);

          friendRequestsList.appendChild(li);
        });
      }

      // –î—Ä—É–∑—ñ
      if (friendsData.length === 0) {
        const li = document.createElement("li");
        li.className = "small-text";
        li.textContent = "–ü–æ–∫–∏ —â–æ –¥—Ä—É–∑—ñ–≤ –Ω–µ–º–∞—î.";
        friendsListEl.appendChild(li);
      } else {
        friendsData.forEach(f => {
          const li = document.createElement("li");
          const dot = document.createElement("span");
          dot.className = "online-dot";

          const entry = onlineMap.get(f.uid);
          const online = entry && entry.online;
          dot.style.backgroundColor = online ? "#2ecc71" : "#95a5a6";

          li.appendChild(dot);
          const text = document.createTextNode(
            " " + f.name + (online ? " ‚Äî –æ–Ω–ª–∞–π–Ω" : " ‚Äî –æ—Ñ–ª–∞–π–Ω")
          );
          li.appendChild(text);

          friendsListEl.appendChild(li);
        });
      }
    }

    function renderSearchResults(results) {
      if (results) {
        lastSearchResults = results;
      }
      const list = lastSearchResults || [];
      searchResultsEl.innerHTML = "";

      if (!currentUser) {
        searchSummary.textContent = "–£–≤—ñ–π–¥–∏, —â–æ–± —à—É–∫–∞—Ç–∏ –≥—Ä–∞–≤—Ü—ñ–≤.";
        return;
      }

      if (list.length === 0) {
        searchSummary.textContent = "–ù—ñ–∫–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.";
        return;
      }

      searchSummary.textContent = "–ó–Ω–∞–π–¥–µ–Ω—ñ –≥—Ä–∞–≤—Ü—ñ:";

      list.forEach(u => {
        const li = document.createElement("li");

        const dot = document.createElement("span");
        dot.className = "online-dot";
        const entry = onlineMap.get(u.uid);
        const online = entry && entry.online;
        dot.style.backgroundColor = online ? "#2ecc71" : "#95a5a6";
        li.appendChild(dot);

        const nameSpan = document.createElement("span");
        nameSpan.textContent = " " + u.name;
        li.appendChild(nameSpan);

        if (u.uid === currentUser.uid) {
          const span = document.createElement("span");
          span.className = "small-text";
          span.textContent = " (—Ü–µ —Ç–∏)";
          li.appendChild(span);
        } else if (friendsData.some(f => f.uid === u.uid)) {
          const span = document.createElement("span");
          span.className = "small-text";
          span.textContent = " (–≤–∂–µ —É –¥—Ä—É–∑—è—Ö)";
          li.appendChild(span);
        } else if (outgoingRequestsSet.has(u.uid)) {
          const span = document.createElement("span");
          span.className = "small-text";
          span.textContent = " (–∑–∞–ø–∏—Ç –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ)";
          li.appendChild(span);
        } else if (incomingRequestsData.some(r => r.fromUid === u.uid)) {
          const span = document.createElement("span");
          span.className = "small-text";
          span.textContent = " (—Ü–µ–π –≥—Ä–∞–≤–µ—Ü—å –Ω–∞–¥—ñ—Å–ª–∞–≤ —Ç–æ–±—ñ –∑–∞–ø–∏—Ç)";
          li.appendChild(span);
        } else {
          const btn = document.createElement("button");
          btn.className = "small-btn";
          btn.textContent = "–î–æ–¥–∞—Ç–∏ –≤ –¥—Ä—É–∑—ñ";
          btn.addEventListener("click", () => sendFriendRequest(u));
          li.appendChild(btn);
        }

        searchResultsEl.appendChild(li);
      });
    }

    // -------- –î—ñ—ó –∑ –¥—Ä—É–∑—è–º–∏ --------
    async function sendFriendRequest(userRec) {
      if (!currentUser) return;
      try {
        await addDoc(collection(db, "friendRequests"), {
          fromUid: currentUser.uid,
          fromName: currentUser.displayName || "–ì—Ä–∞–≤–µ—Ü—å",
          toUid: userRec.uid,
          toName: userRec.name,
          createdAt: serverTimestamp()
        });
      } catch (err) {
        console.error(err);
      }
    }

    async function acceptFriendRequest(req) {
      if (!currentUser) return;
      try {
        const pairId = [req.fromUid, currentUser.uid].sort().join("_");
        const friendsRef = doc(db, "friends", pairId);
        const currentName = currentUser.displayName || "–ì—Ä–∞–≤–µ—Ü—å";
        await setDoc(friendsRef, {
          users: [req.fromUid, currentUser.uid],
          names: [req.fromName, currentName],
          createdAt: serverTimestamp()
        });

        await deleteDoc(doc(db, "friendRequests", req.id));
      } catch (err) {
        console.error(err);
      }
    }

    async function rejectFriendRequest(req) {
      if (!currentUser) return;
      try {
        await deleteDoc(doc(db, "friendRequests", req.id));
      } catch (err) {
        console.error(err);
      }
    }

    // -------- –ü–æ—à—É–∫ –≥—Ä–∞–≤—Ü—ñ–≤ --------
    if (searchBtn) {
      searchBtn.addEventListener("click", async () => {
        if (!currentUser) {
          searchSummary.textContent = "–£–≤—ñ–π–¥–∏, —â–æ–± —à—É–∫–∞—Ç–∏ –≥—Ä–∞–≤—Ü—ñ–≤.";
          return;
        }

        const name = (searchNameInput.value || "").trim();
        if (!name) {
          searchSummary.textContent = "–í–≤–µ–¥–∏ –Ω—ñ–∫–Ω–µ–π–º –¥–ª—è –ø–æ—à—É–∫—É.";
          searchResultsEl.innerHTML = "";
          return;
        }

        searchSummary.textContent = "–®—É–∫–∞—é...";
        searchResultsEl.innerHTML = "";

        try {
          const usersRef = collection(db, "users");
          const q = query(usersRef, where("name", "==", name));
          const snap = await getDocs(q);

          const results = [];
          snap.forEach(docSnap => {
            const data = docSnap.data() || {};
            results.push({
              uid: docSnap.id,
              name: data.name || "–ì—Ä–∞–≤–µ—Ü—å"
            });
          });

          renderSearchResults(results);
        } catch (err) {
          console.error(err);
          searchSummary.textContent = "–ü–æ–º–∏–ª–∫–∞ –ø–æ—à—É–∫—É.";
        }
      });
    }

    // -------- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è --------
    if (signupForm) {
      signupForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        signupStatus.textContent = "";

        const name = signupName.value.trim();
        const email = signupEmail.value.trim();
        const pass = signupPass.value.trim();

        if (!name) {
          signupStatus.textContent = "–í–≤–µ–¥–∏ –Ω—ñ–∫–Ω–µ–π–º.";
          return;
        }

        try {
          const cred = await createUserWithEmailAndPassword(auth, email, pass);
          await updateProfile(cred.user, { displayName: name });

          const userRef = doc(db, "users", cred.user.uid);
          await setDoc(userRef, {
            name,
            email,
            createdAt: serverTimestamp()
          });

          signupStatus.textContent = "–ê–∫–∞—É–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ! –¢–∏ —É–≤—ñ–π—à–æ–≤ —è–∫ " + name;
          signupForm.reset();
        } catch (err) {
          console.error(err);
          signupStatus.textContent = "–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: " + (err.code || err.message);
        }
      });
    }

    // -------- –í—Ö—ñ–¥ --------
    if (loginForm) {
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        loginStatus.textContent = "";

        const email = loginEmail.value.trim();
        const pass = loginPass.value.trim();

        try {
          await signInWithEmailAndPassword(auth, email, pass);
          loginStatus.textContent = "–£—Å–ø—ñ—à–Ω–∏–π –≤—Ö—ñ–¥!";
          loginForm.reset();
        } catch (err) {
          console.error(err);
          loginStatus.textContent = "–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É: " + (err.code || err.message);
        }
      });
    }

    // -------- –í–∏—Ö—ñ–¥ --------
    if (logoutBtn) {
      logoutBtn.addEventListener("click", async () => {
        try {
          await signOut(auth);
        } catch (err) {
          console.error(err);
        }
      });
    }

    // -------- onAuthStateChanged --------
    onAuthStateChanged(auth, (user) => {
      // –í—ñ–¥–ø–∏—Å—É—î–º–æ—Å—è –≤—ñ–¥ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö
      if (friendsUnsub) { friendsUnsub(); friendsUnsub = null; }
      if (incomingReqUnsub) { incomingReqUnsub(); incomingReqUnsub = null; }
      if (outgoingReqUnsub) { outgoingReqUnsub(); outgoingReqUnsub = null; }

      currentUser = user || null;
      friendsData = [];
      incomingRequestsData = [];
      outgoingRequestsSet = new Set();
      renderFriends();
      renderSearchResults([]);

      if (user) {
        const name = user.displayName || "–ì—Ä–∞–≤–µ—Ü—å";
        welcomeName.textContent = name;
        userNameEl.textContent  = name;

        const firstLetter = name.charAt(0).toUpperCase() || "P";
        userAvatar.style.backgroundImage =
          "url('https://dummyimage.com/100x100/383837/ffffff&text=" + encodeURIComponent(firstLetter) + "')";

        authButtons.classList.add("hidden");
        userInfo.classList.remove("hidden");
        authCard.classList.add("hidden");
        loggedCard.classList.remove("hidden");

        if (name === "davyd3102") {
          adminPanel.classList.remove("hidden");
        } else {
          adminPanel.classList.add("hidden");
        }

        // –°–ª—É—Ö–∞—î–º–æ –¥—Ä—É–∑—ñ–≤
        friendsUnsub = onSnapshot(
          query(collection(db, "friends"), where("users", "array-contains", user.uid)),
          (snapshot) => {
            friendsData = [];
            snapshot.forEach(docSnap => {
              const data = docSnap.data() || {};
              const usersArr = data.users || [];
              const namesArr = data.names || [];
              const idx = usersArr.indexOf(user.uid);
              if (idx === -1) return;
              const otherIndex = idx === 0 ? 1 : 0;
              const friendUid = usersArr[otherIndex];
              const friendName = namesArr[otherIndex] || "–ì—Ä–∞–≤–µ—Ü—å";
              friendsData.push({ uid: friendUid, name: friendName });
            });
            renderFriends();
            renderSearchResults(); // –æ–Ω–æ–≤–∏–º–æ —Å—Ç–∞–Ω–∏ "–≤–∂–µ —É –¥—Ä—É–∑—è—Ö"
          }
        );

        // –í—Ö—ñ–¥–Ω—ñ –∑–∞–ø–∏—Ç–∏
        incomingReqUnsub = onSnapshot(
          query(collection(db, "friendRequests"), where("toUid", "==", user.uid)),
          (snapshot) => {
            incomingRequestsData = [];
            snapshot.forEach(docSnap => {
              const data = docSnap.data() || {};
              incomingRequestsData.push({
                id: docSnap.id,
                fromUid: data.fromUid,
                fromName: data.fromName || "–ì—Ä–∞–≤–µ—Ü—å"
              });
            });
            renderFriends();
            renderSearchResults();
          }
        );

        // –í–∏—Ö—ñ–¥–Ω—ñ –∑–∞–ø–∏—Ç–∏
        outgoingReqUnsub = onSnapshot(
          query(collection(db, "friendRequests"), where("fromUid", "==", user.uid)),
          (snapshot) => {
            outgoingRequestsSet = new Set();
            snapshot.forEach(docSnap => {
              const data = docSnap.data() || {};
              if (data.toUid) {
                outgoingRequestsSet.add(data.toUid);
              }
            });
            renderSearchResults();
          }
        );
      } else {
        authButtons.classList.remove("hidden");
        userInfo.classList.add("hidden");
        loggedCard.classList.add("hidden");
        // authCard –º–æ–∂–Ω–∞ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏, —â–æ–± –æ–¥—Ä–∞–∑—É –±–∞—á–∏—Ç–∏ —Ñ–æ—Ä–º–∏
        authCard.classList.remove("hidden");
      }
    });

    // -------- Admin-panel: –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ --------
    if (deleteUserBtn) {
      deleteUserBtn.addEventListener("click", async () => {
        const name = (deleteUserInput.value || "").trim();
        deleteUserStatus.textContent = "";

        if (!name) {
          deleteUserStatus.textContent = "–í–≤–µ–¥–∏ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.";
          return;
        }

        deleteUserStatus.textContent = "–®—É–∫–∞—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ '" + name + "'...";

        try {
          const usersRef = collection(db, "users");
          const q = query(usersRef, where("name", "==", name));
          const snap = await getDocs(q);

          if (snap.empty) {
            deleteUserStatus.textContent = "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ —Ç–∞–∫–∏–º —ñ–º'—è–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.";
            return;
          }

          let deletedCount = 0;

          for (const docSnap of snap.docs) {
            const uid = docSnap.id;
            await deleteDoc(docSnap.ref);

            const gpRef = doc(db, "gamePlayers", uid);
            await deleteDoc(gpRef).catch(() => {});
            deletedCount++;
          }

          deleteUserStatus.textContent =
            "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞(—ñ–≤) '" + name + "' –≤–∏–¥–∞–ª–µ–Ω–æ: " + deletedCount + ".";
          deleteUserInput.value = "";
        } catch (err) {
          console.error(err);
          deleteUserStatus.textContent = "–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ.";
        }
      });
    }

    // -------- –û–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å –∑ gamePlayers --------
    const gamePlayersCol = collection(db, "gamePlayers");
    onSnapshot(
      gamePlayersCol,
      (snapshot) => {
        const now = Date.now();
        const nextMap = new Map();
        snapshot.forEach(docSnap => {
          const data = docSnap.data() || {};
          let updated = 0;
          if (data.updatedAt && data.updatedAt.toDate) {
            updated = data.updatedAt.toDate().getTime();
          }
          const online = updated && (now - updated) < MAX_INACTIVE_MS;
          nextMap.set(docSnap.id, { online });
        });
        onlineMap = nextMap;
        renderFriends();
        renderSearchResults();
      },
      (err) => {
        console.error("–ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è gamePlayers:", err);
      }
    );
  </script>
</body>
</html>
