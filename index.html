<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>PINE Tycoon ‚Äì –ì–æ–ª–æ–≤–Ω–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #f4f4f4;
      --text: #222;
      --card-bg: #ffffff;
      --accent: #383837;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: #383837;
      color: #fff;
    }

    .logo {
      font-weight: 700;
      letter-spacing: 1px;
    }

    nav {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    nav a {
      text-decoration: none;
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
      background: rgba(255,255,255,0.08);
      transition: transform 0.15s, background 0.15s;
      font-size: 14px;
    }

    nav a:hover {
      background: rgba(255,255,255,0.2);
      transform: scale(1.03);
    }

    .auth-buttons button {
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      margin-left: 6px;
      cursor: pointer;
      font-size: 14px;
      background: #ffffff;
      color: #383837;
      transition: transform 0.15s, background 0.15s;
    }

    .auth-buttons button:hover {
      background: #f1f1f1;
      transform: scale(1.03);
    }

    main {
      max-width: 900px;
      margin: 30px auto;
      padding: 0 15px 30px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }

    .hero {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .hero-top {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
    }

    .hero img {
      max-width: 260px;
      border-radius: 12px;
      border: 3px solid #383837;
    }

    .hero-text h1 {
      margin: 0 0 8px;
      font-size: 26px;
      color: #383837;
    }

    .hero-text p {
      margin: 4px 0;
    }

    .status-box {
      font-size: 14px;
      color: #555;
    }

    .auth-forms {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    form {
      flex: 1;
      min-width: 250px;
    }

    form h3 {
      margin-top: 0;
      margin-bottom: 8px;
    }

    label {
      display: block;
      font-size: 13px;
      margin-top: 6px;
    }

    input[type="text"],
    input[type="email"],
    input[type="password"] {
      width: 100%;
      box-sizing: border-box;
      margin-top: 2px;
      padding: 6px 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }

    form button[type="submit"] {
      margin-top: 10px;
      padding: 7px 12px;
      border-radius: 6px;
      border: none;
      background: #383837;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.15s, transform 0.15s;
    }

    form button[type="submit"]:hover {
      background: #222;
      transform: scale(1.02);
    }

    .small-text {
      font-size: 12px;
      color: #777;
      margin-top: 4px;
    }

    .hidden {
      display: none !important;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .avatar {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid #383837;
    }

    .user-name {
      font-weight: 600;
    }

    #logoutBtn {
      border-radius: 6px;
      border: none;
      padding: 6px 10px;
      cursor: pointer;
      background: #e74c3c;
      color: #fff;
      font-size: 13px;
    }

    #logoutBtn:hover {
      background: #c0392b;
    }

    /* Admin –ø–∞–Ω–µ–ª—å */

    #adminPanel {
      margin-top: 16px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #e57373;
      background: #ffebee;
      font-size: 14px;
    }

    #adminPanel h3 {
      margin-top: 0;
      margin-bottom: 6px;
      color: #c62828;
    }

    #deleteUserInput {
      width: 100%;
      box-sizing: border-box;
      margin-top: 4px;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    #deleteUserBtn {
      margin-top: 8px;
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      background: #e53935;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
    }

    #deleteUserBtn:hover {
      background: #c62828;
    }

    #deleteUserStatus {
      margin-top: 6px;
      font-size: 13px;
    }

    #reloadUsersBtn {
      margin-top: 6px;
      padding: 4px 8px;
      border-radius: 6px;
      border: none;
      background: #383837;
      color: #fff;
      font-size: 13px;
      cursor: pointer;
    }

    #reloadUsersBtn:hover {
      background: #222;
    }

    #usersList div {
      margin-bottom: 6px;
    }

    /* –î—Ä—É–∑—ñ */

    #friendsSection h3 {
      margin-top: 0;
      margin-bottom: 8px;
    }

    #searchUserRow {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      margin-bottom: 8px;
    }

    #searchUserInput {
      flex: 1;
      min-width: 180px;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    #searchUserBtn,
    #refreshFriendsBtn {
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      background: #383837;
      color: #fff;
      font-size: 13px;
      cursor: pointer;
    }

    #searchUserBtn:hover,
    #refreshFriendsBtn:hover {
      background: #222;
    }

    #searchUserResults,
    #friendRequestsList,
    #friendsList {
      margin-top: 6px;
      font-size: 13px;
    }

    .user-row {
      border-bottom: 1px solid #eee;
      padding: 4px 0;
    }

    .user-row-main {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .user-row-main span {
      display: block;
    }

    .user-row button {
      padding: 3px 6px;
      border-radius: 4px;
      border: none;
      background: #2e7d32;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
    }

    .user-row button:hover {
      background: #1b5e20;
    }

    .user-row .danger {
      background: #e53935;
    }

    .user-row .danger:hover {
      background: #c62828;
    }

    /* –ü—Ä–æ—Å—Ç–∏–π —Å—Ç–∞—Ç–∏—á–Ω–∏–π –±–ª–æ–≥ (—è–∫ —Ç–µ–∫—Å—Ç) */

    .blog-section h2 {
      margin-top: 0;
    }

    footer {
      text-align: center;
      padding: 12px 10px;
      background: #383837;
      color: #fff;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">PINE Tycoon</div>
    <nav>
      <a href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a>
      <a href="game.html">–ì—Ä–∞—Ç–∏!</a>
      <a href="#blog">–ë–ª–æ–≥</a>

      <div class="auth-buttons" id="authButtons">
        <button id="showAuthBtn">Sign in / Sign up</button>
      </div>

      <div class="user-info hidden" id="userInfo">
        <div class="avatar" id="userAvatar"></div>
        <span class="user-name" id="userName"></span>
        <button id="logoutBtn">–í–∏–π—Ç–∏</button>
      </div>
    </nav>
  </header>

  <main>
    <!-- –ì–æ–ª–æ–≤–Ω–∏–π –±–ª–æ–∫ –ø—Ä–æ –≥—Ä—É -->
    <section class="card hero">
      <div class="hero-top">
        <img
          src="https://learn.logikaschool.com/uploads/student/4796102/6929d42d4c366.png"
          alt="PINE Tycoon –ª–æ–≥–æ"
        />
        <div class="hero-text">
          <h1>PINE Tycoon</h1>
          <p>
            –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –∑–∏–º–æ–≤–æ–≥–æ —Ç–∞–π–∫—É–Ω–∞, –¥–µ –≤–∏ —Ä—É–±–∞—î—Ç–µ –¥–µ—Ä–µ–≤–∞, –±—É–¥—É—î—Ç–µ
            –¥–µ—Ä–µ–≤‚Äô—è–Ω–µ —Å–µ–ª–æ —Ç–∞ –Ω–∞–º–∞–≥–∞—î—Ç–µ—Å—å –Ω–µ –∑–∞–º–µ—Ä–∑–Ω—É—Ç–∏ –≤ –∑–∞–º–µ—Ç—ñ–ª—ñ üå®Ô∏è
          </p>
          <p class="status-box">
            –ü–æ—Ç–æ—á–Ω–∞ –≤–µ—Ä—Å—ñ—è: <b>1.0 ‚Äì –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä–Ω–∞ –∞–ª—å—Ñ–∞</b><br />
            –î–æ–¥–∞–Ω–æ: —Å–∏—Å—Ç–µ–º—É –∞–∫–∞—É–Ω—Ç—ñ–≤, –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä —Ç–∞ –¥—Ä—É–∑—ñ–≤.
          </p>
        </div>
      </div>
    </section>

    <!-- –ë–ª–æ–∫ –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó / –≤—Ö–æ–¥—É -->
    <section class="card" id="authCard">
      <h2>–ê–∫–∞—É–Ω—Ç</h2>
      <p class="small-text">
        –°—Ç–≤–æ—Ä–∏ –∞–∫–∞—É–Ω—Ç, —â–æ–± –≥—Ä–∞—Ç–∏ –ø—ñ–¥ —Å–≤–æ—ó–º —ñ–º‚Äô—è–º —É –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä—ñ —Ç–∞ –¥–æ–¥–∞–≤–∞—Ç–∏ –¥—Ä—É–∑—ñ–≤.
      </p>

      <div class="auth-forms">
        <!-- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è -->
        <form id="signupForm">
          <h3>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h3>
          <label>
            –ù—ñ–∫–Ω–µ–π–º (–±—É–¥–µ –≤–∏–¥–Ω–æ —É –≥—Ä—ñ)
            <input type="text" id="signupName" required />
          </label>
          <label>
            Email
            <input type="email" id="signupEmail" required />
          </label>
          <label>
            –ü–∞—Ä–æ–ª—å
            <input type="password" id="signupPassword" required />
          </label>
          <button type="submit">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç</button>
          <div class="small-text">
            –ü–æ—Ä–∞–¥–∞: –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π —Å–≤—ñ–π —ñ—Å–Ω—É—é—á–∏–π –Ω—ñ–∫, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ <b>davyd3102</b>.
          </div>
          <div id="signupStatus" class="small-text"></div>
        </form>

        <!-- –í—Ö—ñ–¥ -->
        <form id="loginForm">
          <h3>–í—Ö—ñ–¥</h3>
          <label>
            Email
            <input type="email" id="loginEmail" required />
          </label>
          <label>
            –ü–∞—Ä–æ–ª—å
            <input type="password" id="loginPassword" required />
          </label>
          <button type="submit">–£–≤—ñ–π—Ç–∏</button>
          <div id="loginStatus" class="small-text"></div>
        </form>
      </div>
    </section>

    <!-- –ë–ª–æ–∫ –¥–ª—è –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ -->
    <section class="card hidden" id="loggedCard">
      <h2>–ü—Ä–∏–≤—ñ—Ç, <span id="welcomeName">–≥—Ä–∞–≤—Ü—é</span>!</h2>
      <p>
        –¢–∏ —É–≤—ñ–π—à–æ–≤ —É —Å–∏—Å—Ç–µ–º—É. –ö–æ–ª–∏ –∑–∞–ø—É—Å–∫–∞—î—à –≥—Ä—É
        —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É <b>–ì—Ä–∞—Ç–∏!</b>, –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä —Ä–æ–∑–ø—ñ–∑–Ω–∞—î —Ç–≤–æ—î —ñ–º‚Äô—è.
      </p>

      <!-- –î—Ä—É–∑—ñ + –ø–æ—à—É–∫ -->
      <div id="friendsSection">
        <h3>–î—Ä—É–∑—ñ</h3>
        <p class="small-text">
          –ó–Ω–∞–π–¥–∏ —ñ–Ω—à–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ –Ω—ñ–∫–æ–º –∞–±–æ email-–æ–º —ñ –¥–æ–¥–∞–π —É –¥—Ä—É–∑—ñ.  
          –Ü–Ω—à–∞ —Å—Ç–æ—Ä–æ–Ω–∞ –∑–º–æ–∂–µ –ø—Ä–∏–π–Ω—è—Ç–∏ –∞–±–æ –≤—ñ–¥—Ö–∏–ª–∏—Ç–∏ –∑–∞–ø–∏—Ç.
        </p>

        <div id="searchUserRow">
          <input
            id="searchUserInput"
            type="text"
            placeholder="–í–≤–µ–¥–∏ –Ω—ñ–∫ –∞–±–æ email –¥–ª—è –ø–æ—à—É–∫—É..."
          />
          <button id="searchUserBtn">–®—É–∫–∞—Ç–∏</button>
          <button id="refreshFriendsBtn">–û–Ω–æ–≤–∏—Ç–∏ –¥—Ä—É–∑—ñ–≤</button>
        </div>

        <div id="searchUserResults" class="small-text">
          (–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É –∑‚Äô—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç)
        </div>

        <h4>–ó–∞–ø–∏—Ç–∏ –≤ –¥—Ä—É–∑—ñ</h4>
        <div id="friendRequestsList" class="small-text">
          (–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∑–∞–ø–∏—Ç—ñ–≤)
        </div>

        <h4>–ú–æ—ó –¥—Ä—É–∑—ñ</h4>
        <div id="friendsList" class="small-text">
          (–°–ø–∏—Å–æ–∫ –¥—Ä—É–∑—ñ–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π)
        </div>
      </div>

      <!-- –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å –ª–∏—à–µ –¥–ª—è davyd3102 -->
      <div id="adminPanel" class="hidden">
        <h3>Admin –ø–∞–Ω–µ–ª—å (—Ç—ñ–ª—å–∫–∏ –¥–ª—è davyd3102)</h3>
        <p class="small-text">
          –¢—É—Ç —Ç–∏ –º–æ–∂–µ—à –≤–∏–¥–∞–ª—è—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ <b>users</b> —Ç–∞ <b>gamePlayers</b>.  
          <b>–¢—É—Ç –≤–∏–¥–Ω–æ email —É—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</b>. –î–ª—è —ñ–Ω—à–∏—Ö –≥—Ä–∞–≤—Ü—ñ–≤ email –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π.
        </p>

        <!-- –í–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞ —ñ–º'—è–º -->
        <label>
          –Ü–º‚Äô—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è:
          <input id="deleteUserInput" type="text" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 3102" />
        </label>

        <button id="deleteUserBtn">–í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</button>
        <div id="deleteUserStatus"></div>

        <hr style="margin:10px 0;">

        <!-- –°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ -->
        <h4>–°–ø–∏—Å–æ–∫ —É—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h4>
        <p class="small-text">
          –¢—É—Ç –≤–∏–¥–Ω–æ –Ω—ñ–∫, email —Ç–∞ uid –∫–æ–∂–Ω–æ–≥–æ —é–∑–µ—Ä–∞. –¶—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç—ñ–ª—å–∫–∏ —Ç–æ–±—ñ.
        </p>
        <button id="reloadUsersBtn">–û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫</button>
        <div id="usersList" class="small-text" style="margin-top:8px;"></div>
      </div>
    </section>

    <!-- –ü—Ä–æ—Å—Ç–∏–π —Å—Ç–∞—Ç–∏—á–Ω–∏–π –±–ª–æ–≥ —è–∫ —Ç–µ–∫—Å—Ç (–±–µ–∑ Firebase) -->
    <section class="card blog-section" id="blog">
      <h2>–ë–ª–æ–≥</h2>
      <p><i>–û—Å—Ç–∞–Ω–Ω—ñ –∑–º—ñ–Ω–∏:</i></p>
      <ul>
        <li>–î–æ–¥–∞–Ω–æ —Å–∏—Å—Ç–µ–º—É –∞–∫–∞—É–Ω—Ç—ñ–≤ –Ω–∞ Firebase.</li>
        <li>–î–æ–¥–∞–Ω–æ –¥—Ä—É–∑—ñ–≤ —ñ –∑–∞–ø–∏—Ç–∏ –≤ –¥—Ä—É–∑—ñ.</li>
        <li>–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –ø–µ—Ä—à—É –≤–µ—Ä—Å—ñ—é –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä–∞ –≤ –≥—Ä—ñ.</li>
      </ul>
      <p class="small-text">
        –ù–∞–¥–∞–ª—ñ –∑–∞–ø–∏—Å–∏ –º–æ–∂–Ω–∞ –±—É–¥–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –ø—Ä—è–º–æ –≤ –∫–æ–¥—ñ (–∞–±–æ –∑—Ä–æ–±–∏–º–æ –æ–∫—Ä–µ–º—É –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è –±–ª–æ–≥—É).
      </p>
    </section>
  </main>

  <footer>
    ¬© 2025 PINE Tycoon ‚Äî –±–µ—Ç–∞-–≤–µ—Ä—Å—ñ—è –≥—Ä–∏ –∑ –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä–æ–º
  </footer>

  <!-- Firebase + –ª–æ–≥—ñ–∫–∞ –∞–∫–∞—É–Ω—Ç—ñ–≤, –¥—Ä—É–∑—ñ–≤ —ñ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
    import {
      getAuth,
      onAuthStateChanged,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
    import {
      getFirestore,
      collection,
      doc,
      setDoc,
      getDocs,
      getDoc,
      query,
      where,
      deleteDoc,
      updateDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    // üîß Firebase –∫–æ–Ω—Ñ—ñ–≥
    const firebaseConfig = {
      apiKey: "AIzaSyDZEwAbFwLQXxlkkmuMKBFof2J3OE02Egs",
      authDomain: "pine-tycoon.firebaseapp.com",
      projectId: "pine-tycoon",
      storageBucket: "pine-tycoon.firebasestorage.app",
      messagingSenderId: "949986190236",
      appId: "1:949986190236:web:4f5d50078326f5c1981e59",
      measurementId: "G-2DY6KSY4G7"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM-–µ–ª–µ–º–µ–Ω—Ç–∏
    const authCard     = document.getElementById("authCard");
    const loggedCard   = document.getElementById("loggedCard");
    const welcomeName  = document.getElementById("welcomeName");

    const signupForm   = document.getElementById("signupForm");
    const signupName   = document.getElementById("signupName");
    const signupEmail  = document.getElementById("signupEmail");
    const signupPass   = document.getElementById("signupPassword");
    const signupStatus = document.getElementById("signupStatus");

    const loginForm    = document.getElementById("loginForm");
    const loginEmail   = document.getElementById("loginEmail");
    const loginPass    = document.getElementById("loginPassword");
    const loginStatus  = document.getElementById("loginStatus");

    const authButtons  = document.getElementById("authButtons");
    const showAuthBtn  = document.getElementById("showAuthBtn");
    const userInfo     = document.getElementById("userInfo");
    const userAvatar   = document.getElementById("userAvatar");
    const userNameEl   = document.getElementById("userName");
    const logoutBtn    = document.getElementById("logoutBtn");

    // Admin
    const adminPanel       = document.getElementById("adminPanel");
    const deleteUserInput  = document.getElementById("deleteUserInput");
    const deleteUserBtn    = document.getElementById("deleteUserBtn");
    const deleteUserStatus = document.getElementById("deleteUserStatus");
    const reloadUsersBtn   = document.getElementById("reloadUsersBtn");
    const usersList        = document.getElementById("usersList");

    // Friends
    const searchUserInput      = document.getElementById("searchUserInput");
    const searchUserBtn        = document.getElementById("searchUserBtn");
    const searchUserResults    = document.getElementById("searchUserResults");
    const friendRequestsList   = document.getElementById("friendRequestsList");
    const friendsList          = document.getElementById("friendsList");
    const refreshFriendsBtn    = document.getElementById("refreshFriendsBtn");

    // üîπ –ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –±–ª–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –ø–æ –∫–Ω–æ–ø—Ü—ñ –≤ —Ö–µ–¥–µ—Ä—ñ
    if (showAuthBtn) {
      showAuthBtn.addEventListener("click", () => {
        authCard.classList.toggle("hidden");
      });
    }

    // üîπ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
    if (signupForm) {
      signupForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        signupStatus.textContent = "";

        const name = signupName.value.trim();
        const email = signupEmail.value.trim();
        const pass = signupPass.value.trim();

        if (!name) {
          signupStatus.textContent = "–í–≤–µ–¥–∏ –Ω—ñ–∫–Ω–µ–π–º.";
          return;
        }

        try {
          const cred = await createUserWithEmailAndPassword(auth, email, pass);
          await updateProfile(cred.user, { displayName: name });

          const userRef = doc(db, "users", cred.user.uid);
          await setDoc(userRef, {
            name,
            email,
            createdAt: serverTimestamp()
          });

          signupStatus.textContent = "–ê–∫–∞—É–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ! –¢–∏ —É–≤—ñ–π—à–æ–≤ —è–∫ " + name;
          signupForm.reset();
        } catch (err) {
          console.error(err);
          signupStatus.textContent = "–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: " + (err.code || err.message);
        }
      });
    }

    // üîπ –í—Ö—ñ–¥
    if (loginForm) {
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        loginStatus.textContent = "";

        const email = loginEmail.value.trim();
        const pass = loginPass.value.trim();

        try {
          await signInWithEmailAndPassword(auth, email, pass);
          loginStatus.textContent = "–£—Å–ø—ñ—à–Ω–∏–π –≤—Ö—ñ–¥!";
          loginForm.reset();
        } catch (err) {
          console.error(err);
          loginStatus.textContent = "–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É: " + (err.code || err.message);
        }
      });
    }

    // üîπ –í–∏—Ö—ñ–¥
    if (logoutBtn) {
      logoutBtn.addEventListener("click", async () => {
        try {
          await signOut(auth);
        } catch (err) {
          console.error(err);
        }
      });
    }

    // üîπ ID –ø–∞—Ä–∏ –¥–ª—è –¥—Ä—É–∂–±–∏
    function pairId(uid1, uid2) {
      return uid1 < uid2 ? uid1 + "_" + uid2 : uid2 + "_" + uid1;
    }

    // üîπ –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É –≤ –¥—Ä—É–∑—ñ
    async function sendFriendRequest(targetUid, targetName) {
      const user = auth.currentUser;
      if (!user) {
        alert("–°–ø–æ—á–∞—Ç–∫—É —É–≤—ñ–π–¥–∏ –≤ –∞–∫–∞—É–Ω—Ç.");
        return;
      }
      if (user.uid === targetUid) {
        alert("–ù–µ –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ —Å–µ–±–µ –≤ –¥—Ä—É–∑—ñ :)");
        return;
      }

      const myName = user.displayName || "–ì—Ä–∞–≤–µ—Ü—å";
      const id = pairId(user.uid, targetUid);
      const frRef = doc(db, "friendRequests", id);

      try {
        const frSnap = await getDoc(frRef);
        if (frSnap.exists()) {
          const data = frSnap.data();
          if (data.status === "accepted") {
            alert("–í–∏ –≤–∂–µ –¥—Ä—É–∑—ñ.");
            return;
          }
          if (data.status === "pending") {
            if (data.fromUid === user.uid) {
              alert("–ó–∞–ø–∏—Ç —É–∂–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ.");
            } else {
              alert("–£ —Ç–µ–±–µ –≤–∂–µ —î –≤—Ö—ñ–¥–Ω–∏–π –∑–∞–ø–∏—Ç –≤—ñ–¥ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.");
            }
            return;
          }
          if (data.status === "declined") {
            alert("–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∑–∞–ø–∏—Ç –±—É–ª–æ –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ.");
            return;
          }
        }

        await setDoc(frRef, {
          fromUid: user.uid,
          fromName: myName,
          toUid: targetUid,
          toName: targetName,
          status: "pending",
          createdAt: serverTimestamp()
        });

        alert("–ó–∞–ø–∏—Ç —É –¥—Ä—É–∑—ñ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ " + targetName);
      } catch (err) {
        console.error(err);
        alert("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É.");
      }
    }

    // üîπ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥—Ä—É–∑—ñ–≤ —ñ –∑–∞–ø–∏—Ç—ñ–≤
    async function loadFriendsAndRequests() {
      const user = auth.currentUser;
      if (!user) return;

      const uid = user.uid;
      const reqRef = collection(db, "friendRequests");

      // –í—Ö—ñ–¥–Ω—ñ –∑–∞–ø–∏—Ç–∏
      friendRequestsList.textContent = "–ó–∞–≤–∞–Ω—Ç–∞–∂—É—é –∑–∞–ø–∏—Ç–∏...";
      try {
        const incomingQ = query(reqRef, where("toUid", "==", uid));
        const incomingSnap = await getDocs(incomingQ);

        friendRequestsList.innerHTML = "";
        let hasPending = false;

        incomingSnap.forEach((docSnap) => {
          const data = docSnap.data() || {};
          if (data.status !== "pending") return;

          hasPending = true;
          const row = document.createElement("div");
          row.className = "user-row";

          const main = document.createElement("div");
          main.className = "user-row-main";
          const span = document.createElement("span");
          span.textContent = data.fromName + " —Ö–æ—á–µ –¥–æ–¥–∞—Ç–∏ —Ç–µ–±–µ –≤ –¥—Ä—É–∑—ñ";
          main.appendChild(span);

          const btnAccept = document.createElement("button");
          btnAccept.textContent = "–ü—Ä–∏–π–Ω—è—Ç–∏";
          btnAccept.onclick = async () => {
            try {
              await updateDoc(doc(db, "friendRequests", docSnap.id), {
                status: "accepted"
              });
              loadFriendsAndRequests();
            } catch (err) {
              console.error(err);
              alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø—Ä–∏–π–Ω—è—Ç—Ç—ñ –∑–∞–ø–∏—Ç—É.");
            }
          };

          const btnDecline = document.createElement("button");
          btnDecline.textContent = "–í—ñ–¥—Ö–∏–ª–∏—Ç–∏";
          btnDecline.className = "danger";
          btnDecline.onclick = async () => {
            try {
              await updateDoc(doc(db, "friendRequests", docSnap.id), {
                status: "declined"
              });
              loadFriendsAndRequests();
            } catch (err) {
              console.error(err);
              alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—ñ –∑–∞–ø–∏—Ç—É.");
            }
          };

          const btns = document.createElement("div");
          btns.appendChild(btnAccept);
          btns.appendChild(btnDecline);

          main.appendChild(btns);
          row.appendChild(main);
          friendRequestsList.appendChild(row);
        });

        if (!hasPending) {
          friendRequestsList.textContent = "(–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∑–∞–ø–∏—Ç—ñ–≤)";
        }
      } catch (err) {
        console.error(err);
        friendRequestsList.textContent = "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∑–∞–ø–∏—Ç—ñ–≤.";
      }

      // –î—Ä—É–∑—ñ (accepted)
      friendsList.textContent = "–ó–∞–≤–∞–Ω—Ç–∞–∂—É—é –¥—Ä—É–∑—ñ–≤...";
      try {
        const friendsMap = new Map();

        const fromQ = query(reqRef, where("fromUid", "==", uid));
        const fromSnap = await getDocs(fromQ);
        fromSnap.forEach((docSnap) => {
          const data = docSnap.data() || {};
          if (data.status === "accepted") {
            friendsMap.set(data.toUid, data.toName);
          }
        });

        const toQ = query(reqRef, where("toUid", "==", uid));
        const toSnap = await getDocs(toQ);
        toSnap.forEach((docSnap) => {
          const data = docSnap.data() || {};
          if (data.status === "accepted") {
            friendsMap.set(data.fromUid, data.fromName);
          }
        });

        friendsList.innerHTML = "";
        if (friendsMap.size === 0) {
          friendsList.textContent = "(–°–ø–∏—Å–æ–∫ –¥—Ä—É–∑—ñ–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π)";
        } else {
          friendsMap.forEach((name) => {
            const row = document.createElement("div");
            row.className = "user-row";
            const main = document.createElement("div");
            main.className = "user-row-main";

            const span = document.createElement("span");
            span.textContent = name;
            main.appendChild(span);

            row.appendChild(main);
            friendsList.appendChild(row);
          });
        }
      } catch (err) {
        console.error(err);
        friendsList.textContent = "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –¥—Ä—É–∑—ñ–≤.";
      }
    }

    if (refreshFriendsBtn) {
      refreshFriendsBtn.addEventListener("click", loadFriendsAndRequests);
    }

    // üîπ –ü–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (—ñ–Ω—à–∏–º –ø–æ–∫–∞–∑—É—î–º–æ —Ç—ñ–ª—å–∫–∏ –Ω—ñ–∫, –±–µ–∑ email)
    async function searchUsers() {
      const termRaw = searchUserInput.value.trim();
      if (!termRaw) {
        searchUserResults.textContent = "–í–≤–µ–¥–∏ –Ω—ñ–∫ –∞–±–æ email –¥–ª—è –ø–æ—à—É–∫—É.";
        return;
      }
      const term = termRaw.toLowerCase();
      const user = auth.currentUser;
      if (!user) {
        searchUserResults.textContent = "–°–ø–æ—á–∞—Ç–∫—É —É–≤—ñ–π–¥–∏ –≤ –∞–∫–∞—É–Ω—Ç.";
        return;
      }

      searchUserResults.textContent = "–®—É–∫–∞—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤...";
      try {
        const usersRef = collection(db, "users");
        const snap = await getDocs(usersRef);

        searchUserResults.innerHTML = "";
        let found = 0;

        snap.forEach((docSnap) => {
          const data = docSnap.data() || {};
          const uid = docSnap.id;

          const name = (data.name || "").toLowerCase();
          const email = (data.email || "").toLowerCase();

          if (uid === user.uid) return;

          if (name.includes(term) || email.includes(term)) {
            found++;
            const row = document.createElement("div");
            row.className = "user-row";

            const main = document.createElement("div");
            main.className = "user-row-main";

            const span = document.createElement("span");
            span.innerHTML =
              "<b>" + (data.name || "(–±–µ–∑ —ñ–º–µ–Ω—ñ)") + "</b>";
            main.appendChild(span);

            const btnAdd = document.createElement("button");
            btnAdd.textContent = "–î–æ–¥–∞—Ç–∏ –≤ –¥—Ä—É–∑—ñ";
            btnAdd.onclick = () =>
              sendFriendRequest(uid, data.name || "–ì—Ä–∞–≤–µ—Ü—å");

            main.appendChild(btnAdd);
            row.appendChild(main);
            searchUserResults.appendChild(row);
          }
        });

        if (found === 0) {
          searchUserResults.textContent = "–ù—ñ–∫–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.";
        }
      } catch (err) {
        console.error(err);
        searchUserResults.textContent = "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø–æ—à—É–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.";
      }
    }

    if (searchUserBtn) {
      searchUserBtn.addEventListener("click", searchUsers);
    }

    if (searchUserInput) {
      searchUserInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          searchUsers();
        }
      });
    }

    // üîπ –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –∞–¥–º—ñ–Ω–∞ (–∑ email)
    async function loadUsersForAdmin() {
      if (!usersList) return;
      usersList.textContent = "–ó–∞–≤–∞–Ω—Ç–∞–∂—É—é —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤...";

      try {
        const usersRef = collection(db, "users");
        const snap = await getDocs(usersRef);

        if (snap.empty) {
          usersList.textContent = "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —â–µ –Ω–µ–º–∞—î.";
          return;
        }

        usersList.innerHTML = "";

        snap.forEach((docSnap) => {
          const data = docSnap.data() || {};
          const row = document.createElement("div");
          row.className = "user-row";

          const main = document.createElement("div");
          main.className = "user-row-main";

          const span = document.createElement("span");
          span.textContent =
            (data.name || "(–±–µ–∑ —ñ–º–µ–Ω—ñ)") + " ‚Äî " + (data.email || "(–Ω–µ–º–∞—î email)");
          main.appendChild(span);

          const uidSmall = document.createElement("div");
          uidSmall.style.fontSize = "11px";
          uidSmall.style.opacity = "0.7";
          uidSmall.textContent = "uid: " + docSnap.id;
          row.appendChild(uidSmall);

          const delBtn = document.createElement("button");
          delBtn.textContent = "–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞";
          delBtn.className = "danger";
          delBtn.style.marginTop = "2px";
          delBtn.onclick = async () => {
            const nick = data.name || "(–±–µ–∑ —ñ–º–µ–Ω—ñ)";
            if (!confirm("–¢–æ—á–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ " + nick + "?")) return;

            usersList.textContent = "–í–∏–¥–∞–ª—è—é " + nick + "...";

            try {
              await deleteDoc(doc(db, "users", docSnap.id));
              await deleteDoc(doc(db, "gamePlayers", docSnap.id)).catch(() => {});
              usersList.textContent = "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∏–¥–∞–ª–µ–Ω–æ. –ù–∞—Ç–∏—Å–Ω–∏ '–û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫'.";
            } catch (err) {
              console.error(err);
              usersList.textContent = "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.";
            }
          };

          row.appendChild(main);
          row.appendChild(delBtn);
          usersList.appendChild(row);
        });
      } catch (err) {
        console.error(err);
        usersList.textContent = "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.";
      }
    }

    if (reloadUsersBtn) {
      reloadUsersBtn.addEventListener("click", loadUsersForAdmin);
    }

    // üîπ –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ —ñ–º'—è–º (—á–µ—Ä–µ–∑ admin-–ø–∞–Ω–µ–ª—å)
    if (deleteUserBtn) {
      deleteUserBtn.addEventListener("click", async () => {
        const name = deleteUserInput.value.trim();
        deleteUserStatus.textContent = "";

        if (!name) {
          deleteUserStatus.textContent = "–í–≤–µ–¥–∏ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.";
          return;
        }

        deleteUserStatus.textContent = "–®—É–∫–∞—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ '" + name + "'...";

        try {
          const usersRef = collection(db, "users");
          const q = query(usersRef, where("name", "==", name));
          const snap = await getDocs(q);

          if (snap.empty) {
            deleteUserStatus.textContent = "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ —Ç–∞–∫–∏–º —ñ–º'—è–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.";
            return;
          }

          let deletedCount = 0;

          for (const userDoc of snap.docs) {
            const uid = userDoc.id;

            await deleteDoc(userDoc.ref);

            const gpRef = doc(db, "gamePlayers", uid);
            await deleteDoc(gpRef).catch(() => {});

            deletedCount++;
          }

          deleteUserStatus.textContent =
            "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞(—ñ–≤) '" + name + "' –≤–∏–¥–∞–ª–µ–Ω–æ: " + deletedCount + ".";
          deleteUserInput.value = "";
        } catch (err) {
          console.error(err);
          deleteUserStatus.textContent = "–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ.";
        }
      });
    }

    // üîπ onAuthStateChanged ‚Äî –æ–Ω–æ–≤–ª—é—î–º–æ UI
    onAuthStateChanged(auth, (user) => {
      if (user) {
        const name = user.displayName || "–ì—Ä–∞–≤–µ—Ü—å";
        welcomeName.textContent = name;
        userNameEl.textContent  = name;

        const firstLetter = name.charAt(0).toUpperCase() || "P";
        userAvatar.style.backgroundImage =
          "url('https://dummyimage.com/100x100/383837/ffffff&text=" +
          encodeURIComponent(firstLetter) +
          "')";

        authButtons.classList.add("hidden");
        userInfo.classList.remove("hidden");
        authCard.classList.add("hidden");
        loggedCard.classList.remove("hidden");

        // —Ç—ñ–ª—å–∫–∏ –¥–ª—è davyd3102 –ø–æ–∫–∞–∑—É—î–º–æ adminPanel –∑ email
        if (name === "davyd3102") {
          adminPanel.classList.remove("hidden");
          loadUsersForAdmin();
        } else {
          adminPanel.classList.add("hidden");
        }

        loadFriendsAndRequests();
      } else {
        authButtons.classList.remove("hidden");
        userInfo.classList.add("hidden");
        loggedCard.classList.add("hidden");

        friendRequestsList.textContent = "(–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∑–∞–ø–∏—Ç—ñ–≤)";
        friendsList.textContent = "(–°–ø–∏—Å–æ–∫ –¥—Ä—É–∑—ñ–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π)";
        searchUserResults.textContent = "(–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É –∑‚Äô—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç)";
        if (usersList) usersList.innerHTML = "";
      }
    });
  </script>
</body>
</html>
